{"version":3,"file":"app.js","sources":["../../.tmp/concat/scripts/app.js"],"names":["kv","k","v","toString","call","JSON","stringify","a","b","c","d","e","f","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","window","AudioContext","webkitAudioContext","mozAudioContext","msAudioContext","g","h","length","requestAnimationFrame","cancelAnimationFrame","Math","max","Date","setTimeout","clearTimeout","localStorage","getItem","console","log","apply","arguments","this","name","message","infos","prototype","Error","conn","ctx","state","rec","handleError","_","isFunction","onerror","isString","handleResult","onresult","outcome","intent","entities","elem","innerHTML","className","addEventListener","fsm","children","path","document","createElementNS","setAttribute","appendChild","rmactive","classList","remove","mkactive","add","mkthinking","i","j","l","m","n","thinking","getComputedStyle","parseInt","width","height","boxSizing","borderTopWidth","performance","now","o","p","q","PI","cos","sin","rmthinking","disconnected","connect","WebSocket","onopen","token","bps","encoding","send","onclose","onmessage","parse","data","createMediaStreamSource","createScriptProcessor","createJavascriptNode","onaudioprocess","inputBuffer","getChannelData","Int16Array","sampleRate","byteLength","destination","stream","proc","src","audio","connecting","auth-ok","got_stream","error","socket_closed","waiting_for_auth","waiting_for_stream","ready","timeout","start","toggle_record","context","audiostart","code","stop","timer","audioend","result","Array","slice","setContext","Wit","Microphone","mic","getElementById","info","msg","onready","onaudiostart","onaudioend","msg_body","round","confidence","$","addClass","removeClass","err","onconnecting","ondisconnected"],"mappings":"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","sourcesContent":["/* microphone.js 0.7.0 */\n(function(){var a,b,c,d,e,f;b=\"0.7.0\",navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,function(){var a,b,c,d,e,f,g,h;for(e=window,h=[\"ms\",\"moz\",\"webkit\",\"o\"],f=0,g=h.length;g>f&&(d=h[f],!e.requestAnimationFrame);f++)e.requestAnimationFrame=e[\"\"+d+\"RequestAnimationFrame\"],e.cancelAnimationFrame=e[\"\"+d+\"CancelAnimationFrame\"]||e[\"\"+d+\"CancelRequestAnimationFrame\"];if(e.requestAnimationFrame){if(e.cancelAnimationFrame)return;return a=e.requestAnimationFrame,b={},e.requestAnimationFrame=function(c){var d;return d=a(function(a){return d in b?delete b[d]:c(a)})},e.cancelAnimationFrame=function(a){return b[a]=!0}}return c=0,e.requestAnimationFrame=function(a){var b;return c=Math.max(c+16,b=+new Date),e.setTimeout(function(){return a(+new Date)},c-b)},e.cancelAnimationFrame=function(a){return clearTimeout(a)}}(),e=(\"undefined\"!=typeof localStorage&&null!==localStorage?localStorage.getItem:void 0)&&localStorage.getItem(\"wit_debug\")?function(){return console.log.apply(console,arguments)}:function(){},d=function(a,b){return this.name=\"WitError\",this.message=a||\"\",this.infos=b,this},d.prototype=Error.prototype,c=\"wss://api.wit.ai/speech_ws\",a=function(a){var b,c;return this.conn=null,this.ctx=new AudioContext,this.state=\"disconnected\",this.rec=!1,this.handleError=function(a){var b,c;return _.isFunction(c=this.onerror)?(b=_.isString(a)?a:_.isString(a.message)?a.message:\"Something went wrong!\",c.call(window,b,a)):void 0},this.handleResult=function(a){var b,c,d;return _.isFunction(c=this.onresult)?(d=a.outcome.intent,b=a.outcome.entities,c.call(window,d,b,a)):void 0},a&&(this.elem=a,a.innerHTML=\"<div class='mic mic-box icon-wit-mic'>\\n</div>\\n<svg class='mic-svg mic-box'>\\n</svg>\",a.className+=\" wit-microphone\",a.addEventListener(\"click\",function(a){return function(){return a.fsm(\"toggle_record\")}}(this)),c=this.elem.children[1],b=\"http://www.w3.org/2000/svg\",this.path=document.createElementNS(b,\"path\"),this.path.setAttribute(\"stroke\",\"#eee\"),this.path.setAttribute(\"stroke-width\",\"5\"),this.path.setAttribute(\"fill\",\"none\"),c.appendChild(this.path)),this.rmactive=function(){return this.elem?this.elem.classList.remove(\"active\"):void 0},this.mkactive=function(){return this.elem?this.elem.classList.add(\"active\"):void 0},this.mkthinking=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n;return this.thinking=!0,this.elem?(i=getComputedStyle(c),this.elem.classList.add(\"thinking\"),l=parseInt(i.width,10),f=parseInt(i.height,10),b=\"border-box\"===i.boxSizing?parseInt(i.borderTopWidth,10):0,g=l/2-b-5,a=1e3,d=l/2-b,e=f/2-b-g,m=0,j=1,h=(null!=(n=window.performance)?n.now():void 0)||new Date,k=function(c){return function(i){var n,o,p,q;return o=(i-h)%a/a*2*Math.PI-Math.PI/2,p=Math.cos(o)*g+l/2-b,q=Math.sin(o)*g+f/2-b,n=+(1.5*Math.PI>o&&o>Math.PI/2),c.path.setAttribute(\"d\",\"M\"+d+\",\"+e+\"A\"+g+\",\"+g+\",\"+m+\",\"+n+\",\"+j+\",\"+p+\",\"+q),c.thinking?requestAnimationFrame(k):(c.elem.classList.remove(\"thinking\"),c.path.setAttribute(\"d\",\"M0,0\"))}}(this),requestAnimationFrame(k)):void 0},this.rmthinking=function(){return this.thinking=!1},this},f={disconnected:{connect:function(a){var b,d;return a||this.handleError(\"No token provided\"),b=new WebSocket(c),b.onopen=function(){return function(c){var d;return e(\"connection opened\",c),d={token:a,bps:16,encoding:\"signed-integer\"},b.send(JSON.stringify([\"auth\",d]))}}(this),b.onclose=function(a){return function(){return a.fsm(\"socket_closed\")}}(this),b.onmessage=function(a){return function(b){var c,d,e;return e=JSON.parse(b.data),d=e[0],c=e[1],c?a.fsm.call(a,d,c):a.fsm.call(a,d)}}(this),this.conn=b,d=function(a){return function(b){var c,d,f;return c=a.ctx,f=c.createMediaStreamSource(b),d=(c.createScriptProcessor||c.createJavascriptNode).call(c,4096,1,1),d.onaudioprocess=function(b){var c,d,f,g,h,i,j,k;if(a.rec){for(c=b.inputBuffer,d=c.getChannelData(0),h=d.length,g=new Int16Array(h),f=k=0;h>=0?h>=k:k>=h;f=h>=0?++k:--k)i=d[f],j=0>i?32768*i:32767*i,g[f]=j;return e(\"[audiobuffer] rate=\"+c.sampleRate+\", samples=\"+h+\", bytes=\"+g.byteLength),a.conn.send(g)}},f.connect(d),d.connect(c.destination),a.stream=b,a.proc=d,a.src=f,a.fsm(\"got_stream\")}}(this),navigator.getUserMedia({audio:!0},d,this.handleError),\"connecting\"}},connecting:{\"auth-ok\":function(){return\"waiting_for_stream\"},got_stream:function(){return\"waiting_for_auth\"},error:function(a){return this.handleError(a),\"connecting\"},socket_closed:function(){return\"disconnected\"}},waiting_for_auth:{\"auth-ok\":function(){return\"ready\"}},waiting_for_stream:{got_stream:function(){return\"ready\"}},ready:{socket_closed:function(){return\"disconnected\"},timeout:function(){return\"ready\"},start:function(){return this.fsm(\"toggle_record\")},toggle_record:function(){return this.conn.send(JSON.stringify([\"start\",this.context||{}])),this.rec=!0,this.ctx||console.error(\"No context\"),this.stream||console.error(\"No stream\"),this.src||console.error(\"No source\"),this.proc||console.error(\"No processor\"),\"audiostart\"}},audiostart:{error:function(a){return this.rec=!1,this.handleError(new d(\"Error during recording\",{code:\"RECORD\",data:a})),\"ready\"},socket_closed:function(){return this.rec=!1,\"disconnected\"},stop:function(){return this.fsm(\"toggle_record\")},toggle_record:function(){return this.rec=!1,this.conn.send(JSON.stringify([\"stop\"])),this.timer=setTimeout(function(a){return function(){return a.fsm(\"timeout\")}}(this),6e4),\"audioend\"}},audioend:{socket_closed:function(){return this.timer&&clearTimeout(this.timer),\"disconnected\"},timeout:function(){return this.handleError(new d(\"Wit timed out\",{code:\"TIMEOUT\"})),\"ready\"},error:function(a){return this.timer&&clearTimeout(this.timer),this.handleError(new d(\"Wit did not recognize intent\",{code:\"RESULT\",data:a})),\"ready\"},result:function(a){return this.timer&&clearTimeout(this.timer),this.handleResult(a),\"ready\"}}},a.prototype.fsm=function(a){var b,c,d,g;if(c=null!=(g=f[this.state])?g[a]:void 0,b=Array.prototype.slice.call(arguments,1),_.isFunction(c))switch(d=c.apply(this,b),e(\"fsm: \"+this.state+\" + \"+a+\" -> \"+d,b),this.state=d,(\"audiostart\"===d||\"audioend\"===d||\"ready\"===d||\"connecting\"===d||\"disconnected\"===d)&&_.isFunction(c=this[\"on\"+d])&&c.call(window),d){case\"disconnected\":this.rmthinking(),this.rmactive();break;case\"ready\":this.rmthinking(),this.rmactive();break;case\"audiostart\":this.mkactive();break;case\"audioend\":this.mkthinking(),this.rmactive()}else e(\"fsm error: \"+this.state+\" + \"+a,b);return d},a.prototype.connect=function(a){return this.fsm(\"connect\",a)},a.prototype.start=function(){return this.fsm(\"start\")},a.prototype.stop=function(){return this.fsm(\"stop\")},a.prototype.setContext=function(a){var b,c;this.context||(this.context={});for(b in a)c=a[b],this.context[b]=a[b];return e(\"context: \",this.context),null},window._||(window._={}),_.isFunction||(_.isFunction=function(a){return\"function\"==typeof a}),_.isString||(_.isString=function(a){return\"[object String]\"===toString.call(a)}),window.Wit||(window.Wit={}),Wit.Microphone=a}).call(this);\n/**\n*   Application Logic\n*/\n\n'use strict';\nconsole.log('Welcome to Yeogurt');\n\nvar mic = new Wit.Microphone(document.getElementById(\"microphone\"));\n\nvar info = function (msg) {\n    console.log(msg);\n    document.getElementById(\"info\").innerHTML = msg;\n};\n\nvar error = function (msg) {\n  document.getElementById(\"error\").innerHTML = msg;\n};\n\nmic.onready = function () {\n  info(\"Microphone is ready to record\");\n};\n\nmic.onaudiostart = function () {\n  info(\"Recording started\");\n  error(\"\");\n};\n\nmic.onaudioend = function () {\n  info(\"Recording stopped, processing started\");\n};\n\nmic.onresult = function (intent, entities, outcome) {\n    console.log(outcome);\n    document.getElementById(\"result\").innerHTML = '<strong>You said: </strong> ' + outcome.msg_body + '<br><strong>Intent: </strong> ' + outcome.outcome.intent + '<br><strong>Confidence: </strong> ' + Math.round(outcome.outcome.confidence*100) + '%';\n    if (outcome.outcome.intent === 'set_lights_on' && outcome.outcome.confidence > 0.5) {\n        document.getElementById(\"result\").innerHTML = '<strong>You said: </strong> ' + outcome.msg_body + '<br><strong>Intent: </strong> ' + outcome.outcome.intent + '<br><strong>Confidence: </strong> ' + Math.round(outcome.outcome.confidence*100) + '%';\n        $('body').addClass('lights-on');\n    }\n    if (outcome.outcome.intent === 'set_lights_off' && outcome.outcome.confidence > 0.5) {\n        document.getElementById(\"result\").innerHTML = '<strong>You said: </strong> ' + outcome.msg_body + '<br><strong>Intent: </strong> ' + outcome.outcome.intent + '<br><strong>Confidence: </strong> ' + Math.round(outcome.outcome.confidence*100) + '%';\n        $('body').removeClass('lights-on');\n    }\n\n    // var r = kv(\"intent\", intent);\n    // for (var k in entities) {\n    //     var e = entities[k];\n    //     if (!(e instanceof Array)) {\n    //         r += kv(k, e.value);\n    //     } else {\n    //         for (var i = 0; i < e.length; i++) {\n    //             r += kv(k, e[i].value);\n    //         }\n    //     }\n    // }\n    // document.getElementById(\"result\").innerHTML = r;\n};\n\nmic.onerror = function (err) {\n  error(\"Error: \" + err);\n};\n\nmic.onconnecting = function () {\n  info(\"Microphone is connecting\");\n};\n\nmic.ondisconnected = function () {\n  info(\"Microphone is not connected\");\n};\n\nmic.connect(\"V7JHAOR65J2BYFOOSCUZ2EDPWDLP6GVB\");\n  // mic.start();\n  // mic.stop();\n\nfunction kv (k, v) {\n  if (toString.call(v) !== \"[object String]\") {\n    v = JSON.stringify(v);\n  }\n  return k + \"=\" + v + \"\\\\n\";\n}"]}